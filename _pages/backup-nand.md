---
permalink: /backup-nand.html
title: Резервное копирование NAND
author_profile: true
---
{% include toc title="Разделы" %}

**Строго не рекомендуется пропускать этот шаг!** Бекап вам поможет избежать брика и, возможно, даже бана! В теории можно восстановить бекап и получить приставку в исходном состоянии, тогда шанс избежать бана намного выше! В будущем появится Emunand, который будет запускать прошивку не из внутренней памяти приставки (NAND), а из раздела на карте памяти. В таком случае можно будет переключаться между чистой прошивкой, на которой безопасно выходить в интернет, и между прошивкой для пиратства буквально обычной перезагрузкой! Но, опять же, если у вас не будет резервной копии чистой системы, то вы рискуете нивелировать все плюсы Emunand. 
{: .notice--danger}

# Что понадобится

* Свежая версия пейлоада {% include inc/hekate.txt %}
* Работающая microSD с не менее чем 32 Гб свободного места, вставленная в Switch в формате exFAT 
* Свежая версия пейлоада [biskeydump](https://switchtools.sshnuke.net/){:target="_blank"}
* [kezplez-nx.nro](https://github.com/shchmue/kezplez-nx/releases/latest){:target="_blank"}

# Инструкция

## Часть I - Дампим NAND

### Способ I - непосредственно на приставке через hekate

Этот способ требует наличия карты памяти не менее 64х Гб. Если у вас нет таковой, но есть карта меньшего размера, бекап будет делаться по частям. После заполнения текущего объема на карте на экране будет выведена информация о том. что вам необходимо перенести папку backup на ПК, затем вернуть карту в консоль и продолжить создание резервной копии. После того, как все части бекапа буту находиться в одной папке на компьютере, их нужно склеять, используя скрипт [joiner_scripts_for_windows_linux_macos.zip](https://github.com/CTCaer/hekate/releases/download/v4.2/joiner_scripts_for_windows_linux_macos.zip){:target="_blank"}. Этот способ рассматриваться подробно не будет. Он занимает **намного** больше времени. 
{: .notice--info}

1. Запустите пейлоад {% include inc/hekate.txt %} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}

	Для перемещения по меню, hekata используйте клавиши (VOL-) и (VOL+), для выбора - (POWER)
	{: .notice--info}
	
1. Перейдите в меню "Tools"
1. Выберите "Dump package 1/2"
	* Дождитесь окончания резервного копирования 
1. Нажмите любую кнопку для выхода в меню
1. Перейдите в меню "Backup"
1. Выберите "Backup eMMC BOOT0/1"
	* Дождитесь окончания резервного копирования 
1. Нажмите любую кнопку для выхода в меню
1. Выберите "Backup eMMC RAW GPP"
	* Дождитесь окончания резервного копирования
	* Резервное копирование занимает около полутора часов, в зависимости от скорости карты памяти!
1. Нажмите любую кнопку для выхода в меню
1. Выберите "Back", чтобы вернуться в предыдущее меню
1. Вставьте карту памяти свитча в ПК и скопируйте папку "Backup" из корня карты в надёжное место.
1. После того, как бекап будет скопирован, его можно удалить с карты памяти и вставить её обратно в консоль.
1. Выберите "Reboot (RCM)", чтобы перезагрузить Switch в режим RCM для запуска следующего пейлоадера

### Способ II - используя ПК

Этот способ сложнее, чем предыдущий, но не требует наличия большой карты памяти. скорость создания резервной копии таким способом будет упираться в пропускную способность вашего USB-порта. 
{: .notice--info}

1. Выключите консоль
1. Вставьте карту памяти приставки в ПК
1. Убедитесь, что включили [отображение расширений файлов](file-extensions-windows){:target="_blank"}, если у вас Windows
1. Скопируйте **содержимое** папки `sample` из `.zip`-архива с [memloader](https://switchtools.sshnuke.net/){:target="_blank"} в **корень** вашей карты памяти
1. Верните карту памяти обратно в Switch
1. Скопируйте пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} в папку из которой передаёте их на Switch
1. Запустите пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. На экране приставки выберите `ums_eMMC.ini` и запустите
	* Для перемещения по меню используйте клавиши (VOL-) и (VOL+), для выбора - (POWER)
	* Обратите внимание, что выбрали именно "ums_**eMMC**.ini"

	**ВНИМАНИЕ!!!** Если вы в процессе выполнения руководства увидите диалоговое окно, с предложением отформатировать диск - **нажмите отмена**!!
	{: .notice--danger}
	![]({{ base_path }}/images/screenshots/format.png) 
	{: .text-center}
	{: .notice--danger}

	* Экран приставки останется чёрным 
	* В "Мой компьютер" появятся несколько новых дисков
1. Запустите "Диспетчер устройств", убедитесь, что там, в дереве "Дисковые устройства" появилось устройство с названием "LINUX UMS DISK 0"
	* Если такового там нет, 
		* удалите все устройства с восклицательным знаком (так же ставьте галочку на удалении драйверов)
		* удалите все устройства с меткой "USB Download Gadget".
		* После удаления устройств выберите "Действия" -> "Обновить конфигурацию оборудования" в диспетчере устройств
	* Если после всех манипуляций диск так и не появился, выключите Switch и по новой запустите пейлоад `memloader.bin` с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. Скачайте и установите на ваш ПК [win32diskimager](https://sourceforge.net/projects/win32diskimager/){:target="_blank"}
1. На компьютере, кликните правой кнопкой мыши на значок `win32diskimage` и выберите «Запуск от имени администратора». Введите пароль администратора, если требуется, и программа запуститься.
1.	Назовите файл в строке "Image file" `NAND.bin`. Нажмите на кнопку **Read** для дампа NAND на компьютер в файл `NAND.bin`. Процесс может занять несколько минут. Если вы хотите восстановить бэкап NAND на ваше устройство, то нажмите **Write**, и выберите файл вашего бекапа.
1.	Если всё прошло успешно, то дамп NAND появится в директории, которую вы указали. 
1. Вставьте карту памяти свитча в ПК и скопируйте папку "Backup" из корня карты в надёжное место.
1. После того, как бекап будет скопирован, его можно удалить с карты памяти и вставить её обратно в консоль.

### Способ III - используя macOS

Данный способ альтернативен предыдущему и подойдёт тем, кто пользуется операционными системами macOS. Скорость создания резервной копии будет упираться в пропускную способность вашего USB-порта.
{: .notice--info}

1. Выключите консоль
1. Вставьте карту памяти приставки в macOS
1. Скопируйте **содержимое** папки `sample` из `.zip`-архива с [memloader](https://switchtools.sshnuke.net/){:target="_blank"} в **корень** вашей карты памяти
1. Верните карту памяти обратно в Switch
1. Запустите пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. На экране приставки выберите `ums_eMMC.ini` и запустите
	* Для перемещения по меню используйте клавиши (VOL-) и (VOL+), для выбора - (POWER)
	* Обратите внимание, что выбрали именно "ums_**eMMC**.ini"
	* Игнорируйте файлы названия которых начинаются с точки, если таковые будут присутствовать

	**ВНИМАНИЕ!!!** В процессе выполнения руководства вы увидите диалоговое окно с предложением инициализировать диск - **нажмите кнопку пропустить**!!
	{: .notice--danger}
	![]({{ base_path }}/images/screenshots/format_mac.png)
	{: .text-center}
	{: .notice--danger}

	* Экран приставки останется чёрным
1. Запустите программу Дисковая утилита, убедитесь, что там появился внешний диск с названием "Linux UMS disk 0 Media"
	* Если такового нет, то выключите Switch и по новой запустите пейлоад `memloader.bin` с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. В Дисковой утилите нажмите правой кнопкой мыши на пункте "Linux UMS disk 0 Media", выберите опцию "Образ из Linux UMS disk 0 Media" и укажите путь куда сохранить полученный файл. Процесс займёт какое-то время. Если вы хотите восстановить бэкап на ваше устройство, то выберите опцию "Восстановить...", а в появившемся окне нажмите кнопку "Образ..." и укажите путь до сохранённого файла.
1. Если всё прошло успешно, то дамп NAND появится в директории, которую вы указали. Сохраните его в надёжном месте!

## Часть II - Дампим ключи

### Дампим biskeys

1. Запустите пейлоад biskeydump с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}. Не забудьте предварительно разархивировать пейлоад!
1. Отсканируйте появившийся на экране приставки QR-код с помощью смартфона и отправьте на ПК полученные ключи
	* Если вы используйте "TegraRcmSmash", вы можете передать пейлоад через командную строку и получить ключи прямо в ней: `TegraRcmSmash.exe -w -r biskeydump.bin`
1. Сохраните полученные ключи в надежном месте (например, в текстовом файле `keys_bis.txt` и положите его в папку с остальными бекапами)

### Дампим TSEC и общие ключи консоли

1. Запустите hekate и перейдите в "**Console info**" -> "**Print fuse info**"
1. Нажмите (POWER), чтобы сохранить эти данные на карте памяти
1. Запустите hekate и перейдите в "**Console info**" -> "**Print TSEC keys**"
1. Нажмите (POWER), чтобы сохранить эти данные на карте памяти
1. Переместите карту памяти из приставки в ПК
1. Поместите [kezplez-nx.nro](https://github.com/shchmue/kezplez-nx/releases/latest){:target="_blank"} в папку `/switch/`
1. Верните карту памяти обратно в приставку
1. Запустите [HBL](launch-hbl){:target="_blank"}
1. Запустите Kezplez
1. Нажмите (A), чтобы начать дамп ключей
1. Отключите приставку и поместите ее карту памяти в ПК
1. Скопируйте полученные ключи `/switch/kezplez-nx/keys.txt` в папку с остальными бекапами